---
title: "레디스 00(작성중)"
tags:
  - NoSQL
  - database
  - nodejs
categories:
  - database
last_modified_at: 2020-11-16T13:00:00+18:00
toc: true
---

# Redis

레디스는 오픈소스이고, 다양한 서비스에서 사용되고 있다.

레디스는 `In-Memory Database`로서 고가용성인 메모리에 저장하고 조회한다. 기존 관계형 데이터베이스 보다 훨씬 빠를 수 밖에 없는 구조이다.


## 레디스 데이터 타입

레디스의 특징이라면 바로 다양한 자료구조를 지원한다는 점인데, 또 다른 `In-Memory Database`인 `Memcached`와 차이가 두드러진다

![이미지](/assets/images/redis-collection)

레디스는 기본적으로 String, Bitmap, Hash, List, Set, Sorted Set 를 제공했고, 버전이 올라가면서 현재는 Geospatial Index, Hyperloglog, Stream 등의 자료형도 지원하고 있다.
다양한 데이터 타입을 지원하는만큼 때에 따라 다양한 사용방법을 익히고 적용할 수 있다.

### String

스트링 자료구조는 가장 보편적인 데이터 타입이다. 다목적 사용이 가능하며 여러 커맨드를 구비하고 있다.
텍스트 문자열과 정수, 비트맵 등 다양한 타입을 사용할 수 있다. 또한 어떤 형식의 데이터도 될 수 있으며, 512MB를 초과하지 않는 선에서 데이터 타입을 저장 가능하다.

- Cache mechanism: 텍스트나 바이너리 데이터를 캐시 가능하며 API 응답, HTML 페이지의 이미지 혹은 비디오일 수 있다. 간단한 캐싱은 `SET`, `GET`, `MSET`, `MGET`을 이용하여 가능하다.
- Cache with automatic expiration: 자동 만료 키를 사용하여 캐싱을 효과적으로 이용할 수 있다. `SETEX`, `EXPIRE`, `EXPIREAT`와 같은 커맨드를 사용하며, 데이터베이스 실행 시간이 상당히 길며 캐싱을 같이해야 하는 경우 매우 유용할 수 있다.
- Counting: `INCR`, `INCRBY`를 통해 사용가능하다. 카운터는 `page view`, `video view`, `like`에 이용될 수 있으며, `DECR`, `DECRBY`, `INCRFLOATBY` 등도 제공한다.

#### MEST MGET
`MEST`은 다중 키 설정을 도와준다.

`MGET`은 다중 키 획득을 도와준다.

```
$ redis-cli
127.0.0.1:6379> MSET first "First Key value" second "Second Key value"
OK
127.0.0.1:6379> MGET first second
1) "First Key value"
2) "Second Key value"
```

#### EXPIRE TTL
`EXPIRE`는 키에 만료 시간을 설정할 수 있다. 만료시간이 자나면 자동으로 삭제되며, 만료시간이 성공적으로 설정되면 1, 아니면 0을 출력한다.

`TTL`은 아래와 같은 값을 반환한다.
- 양수: 만료까지 남은 시간을 출력한다.
- -2: 키가 존재하지 않거나 만료되었을 경우 출력한다.
- -1: 키가 만료시간이 설정되지 않았을 경우 출력한다.

```
$ redis-cli
127.0.0.1:6379> SET current_chapter "Chapter 1"
OK
127.0.0.1:6379> EXPIRE current_chapter 10
(integer) 1
127.0.0.1:6379> GET current_chapter
"Chapter 1"
127.0.0.1:6379> TTL current_chapter
(integer) 3
127.0.0.1:6379> TTL current_chapter
(integer) -2
127.0.0.1:6379> GET current_chapter
(nil)
```

### INCR INCRBY INCRBYBLOADT

`INCR`과 `INCRBY`는 비슷한 기능을 지원한다.

`INCR`은 키값을 1 올린 후 값을 리턴한다.
`INCRBY`는 주어진 정수 값을 토대로 키 값을 올린 후 값을 리턴한다.

`DECR`과 `DECRBY`는 위 두 커맨드와 상반되게 키 값을 빼는 기능을 제공한다.

`INCRBYFLOAT`는 `FLOAT` 값을 더할 수 있다.
위 세 커맨드 모드 양수 음수 모두 사용할 수 있다.

```
$ redis-cli
127.0.0.1:6379> SET counter 100
OK
127.0.0.1:6379> INCR counter
(integer) 101
127.0.0.1:6379> INCRBY counter 5
(integer) 106
127.0.0.1:6379> DECR counter
(integer) 105
127.0.0.1:6379> DECRBY counter 100
(integer) 5
127.0.0.1:6379> GET counter
"5"
127.0.0.1:6379> INCRBYFLOAT counter 2.4
"7.4"
```

위에 보여진 커맨드는 `ATOMIC`하다 즉, 하나의 오퍼레이션으로 취급한다는 것인데 이는 두 명의 서로 다른 클라이언트가 같은 시간의 같은 실행 명렁어를 통해 같은 값을 얻을 수 없다는 것이다.

예를들어, `counter` 키가 1이라면 서로 다른 클라이언트 A와 B가 `INCR`을 동시에 입력했을 때 A가 2 B가 3을 받게 될것이다.

>?Redis is single threaded, which means that it always executes one
command at a time. Sometimes, commands are mentioned as atomic,
which means that a race condition will never happen when multiple
clients try to perform operations on the same key at the same time.

><font size="6">Refernce</font>
- https://medium.com/garimoo/개발자를-위한-레디스-튜토리얼-01-92aaa24ca8cc
- Maxwell Dayvson Da Silva, Redis Essentials
