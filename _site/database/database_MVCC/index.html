<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.19.3 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="ko" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>MVCC(추가 필요)  |  untitled</title>
<meta name="description" content="">


  <meta name="author" content="조원빈">


<meta property="og:type" content="article">
<meta property="og:locale" content="ko_KR">
<meta property="og:site_name" content="untitled">
<meta property="og:title" content="MVCC(추가 필요)">
<meta property="og:url" content="http://localhost:4000/database/database_MVCC/">


  <meta property="og:description" content="">







  <meta property="article:published_time" content="2020-11-12T00:00:00+09:00">



  <meta property="article:modified_time" content="2020-11-12T04:00:00+09:00">



  

  


<link rel="canonical" href="http://localhost:4000/database/database_MVCC/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "조원빈",
      "url": "http://localhost:4000/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="untitled Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          untitled
          <span class="site-subtitle">기록용 블로그입니다.</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/categories/">Categories</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/">Tags</a>
            </li><li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li><li class="masthead__menu-item">
              <a href="/posts/">연도별 포스트</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">토글 메뉴</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/images/avatar_logo2.jpg" alt="조원빈" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">조원빈</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Was mich nicht umbringt, macht mich stärker.</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">팔로우</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">South Korea</span>
        </li>
      

      
        
          
            <li><a href="mailto:lkic1625@gmail.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span></a></li>
          
        
          
        
          
        
          
        
          
            <li><a href="https://github.com/lkic1625" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://www.instagram.com/__b1n__/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-instagram" aria-hidden="true"></i><span class="label">Instagram</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="MVCC(추가 필요)">
    <meta itemprop="description" content="">
    <meta itemprop="datePublished" content="2020-11-12T00:00:00+09:00">
    <meta itemprop="dateModified" content="2020-11-12T04:00:00+09:00">

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">MVCC(추가 필요)
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  2 분 소요

</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On This Page</h4></header>
              <ul class="toc__menu">
  <li><a href="#mvcc">MVCC</a>
    <ul>
      <li><a href="#concurrency-control">Concurrency Control</a>
        <ul>
          <li><a href="#pessimistic-concurrency-control">Pessimistic Concurrency Control</a></li>
          <li><a href="#optimistic-concurrency-control">Optimistic Concurrency Control</a></li>
          <li><a href="#잠금-구조의-문제점">잠금 구조의 문제점.</a></li>
        </ul>
      </li>
      <li><a href="#mvvc란">MVVC란</a>
        <ul>
          <li><a href="#문장-수준의-읽기-일관성">문장 수준의 읽기 일관성</a></li>
          <li><a href="#트랜잭션-수준의-일관성">트랜잭션 수준의 일관성</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

            </nav>
          </aside>
        
        <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML">
</script>

<h1 id="mvcc">MVCC</h1>
<p><code class="language-plaintext highlighter-rouge">MVCC(Multi Version Concurrency Control)</code>의 약자이다.</p>

<p><code class="language-plaintext highlighter-rouge">Multi Version</code>는 하나의 레코드에 대해 여러 버전이 관리된다는 의미이다. 일반적으로 레코드 레벨의 트랜잭션을 지원하는 <code class="language-plaintext highlighter-rouge">DBMS</code>가 제공하는 기능이며, 가장 큰 목적은 잠금을 사용하지 않는 일관된 읽기를 제공하는데 있다.</p>

<h2 id="concurrency-control">Concurrency Control</h2>
<p><code class="language-plaintext highlighter-rouge">Concurrency Control</code> 즉, 동시성 제어란 <code class="language-plaintext highlighter-rouge">DBMS</code>가 다수의 사용자 사이에서 동시에 작용하는 트랜잭션의 상호간섭 작용에서 데이터베이스를 보호하는 것을 의미한다. 일반적으로 동시성을 허용하면 일관성이 반비례 관계를 갖고 있다.
<img src="/assets/images/consistency-concurrency.png" alt="이미지" /></p>

<p>다수 사용자의 동시 접속을 위해 <code class="language-plaintext highlighter-rouge">DBMS</code>는 동시성 제어를 위해 <code class="language-plaintext highlighter-rouge">Lock</code>기능과 <code class="language-plaintext highlighter-rouge">SET TRANSACTION</code> 명령어를 통해 격리성 수즌을 조정할 수 있도록 한다.</p>

<h3 id="pessimistic-concurrency-control">Pessimistic Concurrency Control</h3>

<ul>
  <li>사용자다들이 같은 데이터를 동시에 수정할 것이라고 가정</li>
  <li>데이터를 읽는 시점에 <code class="language-plaintext highlighter-rouge">Lock</code>을 걸고 트랜잭션이 완료될 때까지 이를 유지</li>
  <li>SELECT 시점에 Lock을 거는 비관적 동시성 제어는 시스템의 동시성을 심각하게 떨어뜨릴 수 있어서 wait 또는 nowait 옵션과 함께 사용해야 함</li>
</ul>

<h3 id="optimistic-concurrency-control">Optimistic Concurrency Control</h3>

<ul>
  <li>사용자들이 같은 데이터를 동시에 수정하지 않을 것이라고 가정</li>
  <li>데이터를 읽는 시점에 <code class="language-plaintext highlighter-rouge">Lock</code>을 걸지 않는 대신 수정 싲머에 값이 변경됐는지를 반드시 검사</li>
</ul>

<h3 id="잠금-구조의-문제점">잠금 구조의 문제점.</h3>

<ul>
  <li>읽기 작업과 쓰기 작업이 서로 방해를 일으키기 때문에 동시성 문제가 발생</li>
  <li>데이터 일관성에 문제가 생기는 경우도 있어서 <code class="language-plaintext highlighter-rouge">Lock</code>을 더 오래 유지하거나 테이블 레벨의 <code class="language-plaintext highlighter-rouge">Lock</code>을 사용해야하고 동시성 저하 발생.</li>
</ul>

<h2 id="mvvc란">MVVC란</h2>

<p><code class="language-plaintext highlighter-rouge">MVCC</code>는 동시 접근을 허용하는 데이터베이스에서 동시성을 제어하기 위해 사용하는 방법 중 하나이다.</p>

<p><code class="language-plaintext highlighter-rouge">MVCC</code> 모델에서 데이터에 접근하는 사용자는 접근한 시점에서 데이터베이스의 <code class="language-plaintext highlighter-rouge">Snapshot</code>을 읽는다. 이 스냅샷 데이터에 대한 변경이 완료될 때 즉, 트랜잭션이 커밋될 때까지 만들어진 변경사항은 다른 데이터베이스 사용자가 볼 수 없다. 이제 사용자가 데이터를 업데이트하면 이전의 데이터를 덮어 씌우는 게 아니라 새로운 버전의 데이터를 <code class="language-plaintext highlighter-rouge">UNDO</code> 영역에 생성한다. 대신 이전 버전의 데이터와 비교해서 변경된 내용을 기록한다. 이렇게 해서 하나의 데이터에 대해 여러 버전의 데이터가 존재하게 되고, 사용자는 마지막 버전의 데이터를 읽게된다. 특징은 아래와 같다.</p>

<ul>
  <li>일반적인 <code class="language-plaintext highlighter-rouge">RDBMS</code>보다 빠르게 작동</li>
  <li>사용하지 않는 데아터가 계속 쌓이게 되므로 데이터를 정리하는 시스템이 필요</li>
  <li>데이터 버전이 충돌하면 어플리케이션 영역에서 수정해야 한다.</li>
</ul>

<p>접근 방식이 잠금 구조를 사용하지 않기 때문에 일반적인 <code class="language-plaintext highlighter-rouge">RDBMS</code> 보다 빠르게 작동한다. 또한, 데이터를 읽기 시작할 때, 다른 사람이 그 데이터를 삭제하거나 수정하더라도 영향을 받지 않고 계속 사용할 수 있다. 대신 사용하지 않는 데이터가 계속 쌓이게 되므로 데이터를 정리하는 시스템이 필요할 것이다. 오라클은 <code class="language-plaintext highlighter-rouge">UNDO Segment</code>를 이용한다.</p>

<p>또한, <code class="language-plaintext highlighter-rouge">UNDO Block I/O</code>, <code class="language-plaintext highlighter-rouge">CR Copy 생성</code> <code class="language-plaintext highlighter-rouge">CR 블록 캐싱</code> 같은 부가적인 작업의 오버헤드가 발생한다. 이러한 구조의 <code class="language-plaintext highlighter-rouge">MVCC</code>는 문장 수준과 트랜잭션 수준의 읽기 일관성이 존재한다.</p>

<p>MVCC는 포인트-인-타임 일관성(point-in-time consistent) 뷰를 제공한다. MVCC 상태에서 읽기 트랜잭션은 일반적으로 타임스탬프나 트랜잭션 ID를 사용하여 읽을 DB의 상태를 결정하고 데이터의 버전들을 읽는다. 그러므로 읽기, 쓰기 트랜잭션은 락(lock)의 필요 없이 다른 트랜잭션과 격리된다. 그러나 락이 불필요함에도 불구하고 오라클 등 일부 MVCC 데이터베이스에서는 락이 사용된다. 쓰기는 더 새로운 버전을 만드는 반면, 동시성 읽기는 더 오래된 버전에 접근한다.</p>

<h3 id="문장-수준의-읽기-일관성">문장 수준의 읽기 일관성</h3>

<p>문장수준 읽기 일관성은 다른 트랜잭션에 의해 데이터의 <code class="language-plaintext highlighter-rouge">CRUD</code>가 발생하더라도 단일 <code class="language-plaintext highlighter-rouge">SQL</code>문 내에서 일관성 있게 값을 읽는 것을 말한다.</p>

<ul>
  <li>일관성 기준 시점은 쿼리 시작점이 된다.</li>
</ul>

<h3 id="트랜잭션-수준의-일관성">트랜잭션 수준의 일관성</h3>

<p>트랜잭션 수준 읽기 일관성은 다른 트랜잭션에 의해 데이터의 <code class="language-plaintext highlighter-rouge">CRUD</code>가 발생하더라도 트랜잭션 내에서 일관성 있게 값을 읽는 것을 말한다.
<code class="language-plaintext highlighter-rouge">MVVC</code> 구조 또한 트랜잭션 수준 읽기 일관성을 보장하지 못한다. 따라서, 트랜잭션 수준으로 완벽한 읽기 일관성을 보장하려면 격리성 수준을 <code class="language-plaintext highlighter-rouge">Serializable Read</code>로 올려주어야 한다.
Isolation Level을 Serializable Read로 상향 조정하면, 일관성 기준 시점은 트랜잭션 시작 시점이 된다. 물론 트랜잭션이 진행되는 동한 발생한 변동사항은 변동사항 그대로 읽는다.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">alter</span> <span class="k">database</span> <span class="o">&lt;</span><span class="err">데이터베이스</span> <span class="err">이름</span><span class="o">&gt;</span> <span class="k">set</span> <span class="n">allow_snapshot_isolation</span> <span class="k">on</span><span class="p">;</span>

<span class="c1">-- 트랜잭션 시작하기 전 'snapshot'으로 변경</span>

<span class="k">set</span> <span class="n">tranaction</span> <span class="k">isolation</span> <span class="k">level</span> <span class="n">snapshot</span>

<span class="k">begin</span> <span class="n">tran</span>

    <span class="k">select</span> <span class="p">...;</span>
    <span class="k">update</span> <span class="p">...;</span>
<span class="k">commit</span><span class="p">;</span>
</code></pre></div></div>

<blockquote>
  <font size="6">Refernce</font>
  <ul>
    <li>https://mangkyu.tistory.com/53</li>
    <li>https://kslee7746.tistory.com/entry/SQLP-%EB%8F%99%EC%8B%9C%EC%84%B1-%EC%A0%9C%EC%96%B4</li>
    <li>https://ko.wikipedia.org/wiki/다중_버전_동시성_제어</li>
  </ul>
</blockquote>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> 태그: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#database" class="page__taxonomy-item" rel="tag">database</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#mvvc" class="page__taxonomy-item" rel="tag">MVVC</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> 카테고리: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#database" class="page__taxonomy-item" rel="tag">database</a>
    
    </span>
  </p>


        
  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> 업데이트:</strong> <time datetime="2020-11-12">November 12, 2020</time></p>


      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">공유하기</h4>
  

  <a href="https://twitter.com/intent/tweet?text=MVCC%28%EC%B6%94%EA%B0%80+%ED%95%84%EC%9A%94%29%20http%3A%2F%2Flocalhost%3A4000%2Fdatabase%2Fdatabase_MVCC%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="공유하기 Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fdatabase%2Fdatabase_MVCC%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="공유하기 Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fdatabase%2Fdatabase_MVCC%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="공유하기 LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/database/B+_tree/" class="pagination--pager" title="B+tree, InnoDB Structure(작성중)
">이전</a>
    
    
      <a href="/database/innoDB_index_page/" class="pagination--pager" title="InnoDB 인덱스 페이지 구조
">다음</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">참고</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/backend/websocket/" rel="permalink">WebSocket
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  6 분 소요

</p>
    
    <p class="archive__item-excerpt" itemprop="description">Introduction
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/algorithm/pollards_rho/" rel="permalink">Pollard’s rho algorithm
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  5 분 소요

</p>
    
    <p class="archive__item-excerpt" itemprop="description">

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/backend/http_headers/" rel="permalink">HTTP 헤더
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  7 분 소요

</p>
    
    <p class="archive__item-excerpt" itemprop="description">Introduction
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/nodejs/node_event_loop/" rel="permalink">Node.js 이벤트 루프
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  6 분 소요

</p>
    
    <p class="archive__item-excerpt" itemprop="description">Introduction
</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>팔로우:</strong></li>
    

    
      
        
      
        
      
        
          <li><a href="https://github.com/lkic1625" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
      
        
          <li><a href="https://www.instagram.com/__b1n__/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-instagram" aria-hidden="true"></i> Instagram</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> 피드</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2020 조원빈. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>










  </body>
</html>
